# rmuc2022-simulator-tju

北洋机甲前算法组成员杨铭

于2022年7月至2023年6月

基于Unity开发的RMUC2022赛季开源模拟器

inspired by DJI裁判系统客户端 &amp; 华南虎Simulator2021

## 1 工程简介

开发环境Unity Editor 2021.3.8f1c1. 使用UnityHub “打开” > 选中`Assets/`的父文件夹。

注1：第一次打开工程需要编译，所需时间较长，约几分钟至几十分钟。

注2：simulator的场景文件共两个，即选择游玩模式的`Lobby.unity`和实际对抗`BattleField.unity`，位于`Assets/Scenes/`目录下，双击打开后Unity Editor窗口即可呈现场景。

注3：Ctrl+Shift+B更改编译设置，如编译平台等；Ctrl+B即可打包工程。

注4：由于开发环境不完全一致，出现报错是正常现象，可google可联系作者可提issue。

## 2 使用说明

simulator可以单机也可联机，联机时房间创建者的电脑为服务器（记作server PC），其他玩家（记作client PC）可通过局域网连接和ipv6连接加入房间。（若不在同一局域网且无ipv6地址，可通过内网穿透等方式连接）。

### 2.1 网速要求

server PC和client PC的网络带宽建议不小于1Mb/s，网速占用的理论值约为10Kb/s至20Kb/s。网络延迟应尽可能低，以保证client PC与server PC上机器人的行为一致。（simulator数据汇总于server PC运算，一切数据以server PC上的运算结果为准）

### 2.2 配置要求

目前，由于simulator还未应用LOD，场景中三角面个数较多，需要一定算力的CPU和显卡。9代i5+GTX1650笔记本可稳定90帧。

日志文件：日志缓存在路径`.\rmuc_simu_preview_Data\YOUR_LOGS`中，删除后不影响程序运行。

### 2.3 按键指南

进入BattleField场景后，各机器人的按键如下：

注1：按`键打开设置界面，选择Quit退出当前比赛，并返回至Lobby。

注2：工程括号内为夹爪模式下的操作，如：r键 => 伸出/缩回救援卡；左shift+r键 => 夹爪开启/关闭吸力。

|       按键       |           步兵（infantry）          |            英雄（hero）             |           工程（engineer）           |            无人机（drone）            |
| :--------------: | :---------------------------------: | :---------------------------------: | :----------------------------------: | :-----------------------------------: |
|       Esc        |            鼠标锁定/解锁            |            鼠标锁定/解锁            |            鼠标锁定/解锁             |             鼠标锁定/解锁             |
| `（Esc下面那个） |            打开设置界面             |            打开设置界面             |             打开设置界面             |             打开设置界面              |
|        o         |            打开补弹界面             |            打开补弹界面             |             打开补弹界面             |             打开补弹界面              |
|     w/a/s/d      |              前后左右               |              前后左右               |       前后左右（夹爪伸缩平移）       |               前后左右                |
|        r         |                  \                  |                  \                  | 伸出/缩回救援卡（夹爪开启/关闭吸力） | 呼叫空中支援，若队伍金币少于300则无效 |
|        c         |            开启/关闭电容            |            开启/关闭电容            |        无  (夹爪向外翻转90度)        |                   \                   |
|        z         |                  \                  |                  \                  |        无 (夹爪向内翻转90度)         |                   \                   |
|        x         |                刹车                 |                刹车                 |                 刹车                 |                   \                   |
|       e/q        |                  \                  |                  \                  |              右转/左转               |               上升/下降               |
|     左shift      |               小陀螺                |               小陀螺                |  按下时为夹爪模式，松开时为普通模式  |                   \                   |
|     鼠标左键     |              发射弹丸               |              发射弹丸               |                  \                   |               发射弹丸                |
|     鼠标右键     | 装甲板自瞄，若r键按下，则为打符自瞄 | 装甲板自瞄，若r键按下，则为打符自瞄 |                  \                   |  装甲板自瞄，若r键按下，则为打符自瞄  |
|     移动鼠标     |              调整视角               |              调整视角               |               调整视角               |               调整视角                |

## 3 演示

### 3.1 用户登录界面

用户在此填写昵称（i.e. Player Name）

建议不多于六个半角字符，如果不想昵称显示不全的话。

每次启动simulator，默认是电脑名称。

<img src="README.assets\log_in.png" alt="log_in" style="zoom: 67%;" />

### 3.2 游玩模式选择

`Single Player`本地跑图

`Multi Player`创建房间并允许其他玩家加入

`Back`返回登录界面

<img src="README.assets\select_mode.png" alt="select_mode" style="zoom:67%;" />

### 3.3 兵种选择

`Start Game`仅房主可选，点击后开始游戏，并切换场景至BattleField

点击兵种旁边的按钮（红方阵营在序号左侧，蓝方阵营在序号右侧），即可选择该兵种；选中后，非房主的`Start Game`位置显示为`Cancel Ready`，用于告知房主 本机是否准备好，但不会影响`Start Game`的执行（这是为了防止恶意影响比赛开始）

<img src="README.assets\select_robot.png" alt="select_robot" style="zoom:67%;" />

### 3.4 比赛场地

UI模拟真实比赛的操作界面（但不支持自主定制，除非改源码），同时，在左下角增加了电容指示条和经验指示条。

<img src="README.assets\in_game1.png" alt="in_game1" style="zoom: 33%;" />

开车不规范，队友两行泪(doge)，下坡翻车后神仙难救 :)

<img src="README.assets\in_game2.png" alt="in_game2" style="zoom: 33%;" />

## 4 致谢

感谢大疆创新创办的机甲大师系列比赛，其比赛机制新颖而富于挑战、比赛场地美观而科技感十足。simulator的比赛场地相关UI和CG均参照其样式制作，没有DJI精妙设计的比赛机制，simulator无从谈起。

感谢华南虎战队2021年发布的模拟器，那是我接触到的第一款超级对抗赛的模拟器，也让我萌生了从零开发simulator的念头。没有他们先驱性的创想，我也不会产生搭建simulator的意愿和行动。

感谢北洋机甲战队每一位成员，他们无私地提供了2022赛季所有机器人的高精度三维模型，为提高simulator的视觉还原度和物理拟真度做出了重要的贡献。

特别鸣谢舍友张宸睿和曹鸿钰，他们在开发过程和预发布过程中积极参与了simulator的网络连接、多人对抗等测试，并从控制逻辑仿真、三角面优化等方面提供了大量宝贵意见，直接推进了simulator的迭代优化。

## 5 反馈

如有任何疑问、意见或建议，包括但不限于机制bug、穿模、操作反人类、UI美化等，欢迎联系作者。QQ：1308592371；Email：mingyang2601@outlook.com。

Enjoy it!
